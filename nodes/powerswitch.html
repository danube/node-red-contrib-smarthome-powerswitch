<!-- BEGIN configuration -->

<script type="text/javascript">
	RED.nodes.registerType ('powerswitch configuration', {
		category: 'config',
		defaults: {
			name: {value: ""},
			// BEGIN Toggle
			toggleTopic: {value: ""},
			togglePayload: {value: "true", validate: RED.validators.typedInput("togglePayloadType")},
			togglePayloadType: {value: "bool"},
			// BEGIN Motion Detector
			motionTopic: {value: ""},
			motionPayloadOn: {value: "true", validate: function(v) {return v != this.motionPayloadOff}},
			motionPayloadOnType: {value: "bool"},
			motionPayloadOff: {value: "false", validate: function(v) {return v != this.motionPayloadOn}},
			motionPayloadOffType: {value: "bool"},
			motionTimeoutValue: {value: "2", required: true, validate: function(v) {return v > 0}},
			motionTimeoutUnit: {value: "m"},
			motionTimeoutOverride: {value: false},
			motionOnIgnoreActive: {value: false},
			motionOnIgnoreTime: {value: "10", required: true},
			// BEGIN Force Command
			forceTopic: {value: ""},
			forcePayloadOn: {value: "true", validate: function(v) {return v != this.forcePayloadOff}},
			forcePayloadOnType: {value: "bool"},
			motionOverridesForceOn: {value: false},
			forcePayloadOff: {value: "false", validate: function(v) {return v != this.forcePayloadOn}},
			forcePayloadOffType: {value: "bool"},
			// BEGIN Device Feedback
			feedbackActive: {value: false},
			feedbackTopic: {value: ""},
			feedbackPayloadOn: {value: "true", validate: function(v) {return v != this.feedbackPayloadOff || !this.feedbackActive}},
			feedbackPayloadOnType: {value: "bool"},
			feedbackPayloadOff: {value: "false", validate: function(v) {return v != this.feedbackPayloadOn || !this.feedbackActive}},
			feedbackPayloadOffType: {value: "bool"},
			// BEGIN Absolute Timeout
			absTimeoutActive: {value: false},
			absTimeoutValue: {value: "1", required: true, validate: function(v) {
					let motionFactor = 1
					if (this.motionTimeoutUnit == "m") {motionFactor = 60}
					else if (this.motionTimeoutUnit == "h") {motionFactor = 3600}
					let absFactor = 1
					if (this.absTimeoutUnit == "m") {absFactor = 60}
					else if (this.absTimeoutUnit == "h") {absFactor = 3600}
					return v * absFactor > this.motionTimeoutValue * motionFactor || !this.absTimeoutActive}},
			absTimeoutUnit: {value: "h"},
			// BEGIN Output
			outputTopic: {value: ""},
			outputPayloadOnType: {value: "bool"},
			outputPayloadOn: {value: "true"},
			outputPayloadOffType: {value: "bool"},
			outputPayloadOff: {value: "false"}
		},
		label: function() {
			let app = this.motionTimeoutValue + this.motionTimeoutUnit
			if (this.motionTimeoutOverride) {app = app + "*"}
			if (this.absTimeoutActive) {app = app + "/" + this.absTimeoutValue + this.absTimeoutUnit}
			return (this.name || "Powerswitch Configuration") + " (" + app + ")"
		},
		oneditprepare: function() {
			// Help Button
			$('<button type="button" class="ui-button ui-corner-all ui-widget"><i class="fa fa-book"></i> Manual</button>')
			.on("click", () => {RED.sidebar.help.show(this.type)})
			.insertBefore($("#node-config-dialog-cancel"))
			// Toggle Payload
			$("#node-config-input-togglePayload").typedInput({
				typeField: $("#node-config-input-togglePayloadType"),
				types:['bool','str','num']
			});
			// Motion Payload ON
			$("#node-config-input-motionPayloadOn").typedInput({
				typeField: $("#node-config-input-motionPayloadOnType"),
				types:['bool','str','num']
			});
			// Motion Payload OFF
			$("#node-config-input-motionPayloadOff").typedInput({
				typeField: $("#node-config-input-motionPayloadOffType"),
				types:['bool','str','num']
			});
			// Feedback Payload ON
			$("#node-config-input-feedbackPayloadOn").typedInput({
				typeField: $("#node-config-input-feedbackPayloadOnType"),
				types:['bool','str','num']
			});
			// Feedback Payload OFF
			$("#node-config-input-feedbackPayloadOff").typedInput({
				typeField: $("#node-config-input-feedbackPayloadOffType"),
				types:['bool','str','num']
			});
			// Force Payload ON
			$("#node-config-input-forcePayloadOn").typedInput({
				typeField: $("#node-config-input-forcePayloadOnType"),
				types:['bool','str','num']
			});
			// Force Payload OFF
			$("#node-config-input-forcePayloadOff").typedInput({
				typeField: $("#node-config-input-forcePayloadOffType"),
				types:['bool','str','num']
			});
			// Output Payload ON
			$("#node-config-input-outputPayloadOn").typedInput({
				typeField: $("#node-config-input-outputPayloadOnType"),
				types:['bool','str','num']
			});
			// Output Payload OFF
			$("#node-config-input-outputPayloadOff").typedInput({
				typeField: $("#node-config-input-outputPayloadOffType"),
				types:['bool','str','num']
			});

			// hide feedback config area
			$("#node-config-input-feedbackActive").on('change', function(){
				if ($("#node-config-input-feedbackActive")[0].checked) {
					$('#feedbackConfig').show('fast');
				} else {
					$('#feedbackConfig').hide('fast');
				}
			})

			// hide absTimeout config area
			$("#node-config-input-absTimeoutActive").on('change', function(){
				if ($("#node-config-input-absTimeoutActive")[0].checked) {
					$('#node-config-input-absTimeoutValue').prop('disabled', false);
					$('#node-config-input-absTimeoutUnit').prop('disabled', false);
				} else {
					$('#node-config-input-absTimeoutValue').prop('disabled', true);
					$('#node-config-input-absTimeoutUnit').prop('disabled', true);
				}
			})

			// disable ignore motion on config area
			$("#node-config-input-motionOnIgnoreActive").on('change', function(){
				if ($("#node-config-input-motionOnIgnoreActive")[0].checked) {
					$('#node-config-input-motionOnIgnoreTime').prop('disabled', false);
				} else {
					$('#node-config-input-motionOnIgnoreTime').prop('disabled', true);
				}
			})

			// Workaround as new parameters don't inherit values set by defaults
			// https://discourse.nodered.org/t/node-config-parameter-not-following-default-value/83393
			if (this.outputPayloadOff === undefined) {
				$('#node-config-input-outputPayloadOff').typedInput('value', 'false');
			}
			if (this.motionOnIgnoreTime === undefined) {
				$('#node-config-input-motionOnIgnoreTime').val(10)
			}

		}
	})
</script>

<script type="text/html" data-template-name="powerswitch configuration">

	<!-- Name -->
	<div class="form-row">
		<label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.name"></span></label>
		<input type="text" id="node-config-input-name" data-i18n="[placeholder]placeholder.configSetName">
	</div>

	<!-- Toggle -->
	<h3><span data-i18n="head.toggle"></span></h3>
	<div class="form-row">
		<label for="node-config-input-toggleTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.topic"></span></label>
		<input type="text" id="node-config-input-toggleTopic" data-i18n="[placeholder]placeholder.toggleTopic">
	</div>
	<div class="form-row">
		<label for="node-config-input-togglePayload"><i class="fa fa-tag"></i> <span data-i18n="common.payload"></span></label>
		<input type="hidden" id="node-config-input-togglePayloadType">
		<input style="width:70%" type="text" id="node-config-input-togglePayload">
	</div>

	<!-- Motion detector -->
	<h3><span data-i18n="head.motion"></span></h3>
	<div class="form-row">
		<label for="node-config-input-motionTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.topic"></span></label>
		<input type="text" id="node-config-input-motionTopic" data-i18n="[placeholder]placeholder.motionTopic">
	</div>
	<div class="form-row">
		<label for="node-config-input-motionPayloadOn"><i class="fa fa-tag"></i> <span data-i18n="common.onPayload"></span></label>
		<input type="hidden" id="node-config-input-motionPayloadOnType">
		<input style="width:70%" type="text" id="node-config-input-motionPayloadOn">
	</div>
	<div class="form-row">
		<label for="node-config-input-motionPayloadOff"><i class="fa fa-tag"></i> <span data-i18n="common.offPayload"></span></label>
		<input type="hidden" id="node-config-input-motionPayloadOffType">
		<input style="width:70%" type="text" id="node-config-input-motionPayloadOff">
	</div>
	<div class="form-row">
		<label><i class="fa fa-sliders"></i> <span data-i18n="common.timeout"></span></label>
		<input type="number" id="node-config-input-motionTimeoutValue" min="1" style="text-align: end; width: 70px !important">
		<select id="node-config-input-motionTimeoutUnit" style="width:140px !important">
			<option value="s" data-i18n="common.seconds"></option>
			<option value="m" data-i18n="common.minutes"></option>
			<option value="h" data-i18n="common.hours"></option>
		</select>
	</div>
	<div class="form-row">
		<label><i class="fa fa-sliders"></i> <span data-i18n="common.allow"></span></label>
		<input type="checkbox" id="node-config-input-motionTimeoutOverride" style="margin-left:0px; vertical-align:top; width:auto !important;">
		<label style="width:auto !important;" for="node-config-input-motionTimeoutOverride" data-i18n="common.timeoutoverride"></label>
	</div>
	<div class="form-row">
		<label><i class="fa fa-sliders"></i> <span data-i18n="common.ignoreFor"></span></label>
		<input type="checkbox" id="node-config-input-motionOnIgnoreActive" style="display:inline-block; width:auto;">
		<input type="number" id="node-config-input-motionOnIgnoreTime" min="1" style="text-align: end; width: 70px !important; margin-left: 5px"> <span data-i18n="common.secsAfterManOff"></span>
	</div>
	
	<!-- Force message -->
	<h3><span data-i18n="head.force"></span></h3>
	<div class="form-row">
		<label for="node-config-input-forceTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.topic"></span></label>
		<input type="text" id="node-config-input-forceTopic" data-i18n="[placeholder]placeholder.forceTopic">
	</div>
	<div class="form-row">
		<label for="node-config-input-forcePayloadOn"><i class="fa fa-tag"></i> <span data-i18n="common.onPayload"></span></label>
		<input type="hidden" id="node-config-input-forcePayloadOnType">
		<input style="width:70%" type="text" id="node-config-input-forcePayloadOn">
	</div>
	<div class="form-row">
		<label></label>
		<input type="checkbox" id="node-config-input-motionOverridesForceOn" style="margin-left:0px; vertical-align:top; width:auto !important;">
		<label style="width:auto !important;" for="node-config-input-motionOverridesForceOn" data-i18n="common.motionOverridesForceOn"></label>
	</div>
	<div class="form-row">
		<label for="node-config-input-forcePayloadOff"><i class="fa fa-tag"></i> <span data-i18n="common.offPayload"></span></label>
		<input type="hidden" id="node-config-input-forcePayloadOffType">
		<input style="width:70%" type="text" id="node-config-input-forcePayloadOff">
	</div>

	<!-- Actuator feedback message -->
	<h3><span data-i18n="head.feedback"></span></h3>
	<div class="form-row">
		<label><i class="fa fa-power-off"></i> <span data-i18n="common.enable"></span></label>
		<input type="checkbox" id="node-config-input-feedbackActive" style="display:inline-block; width:auto;">
	</div>
	<div id="feedbackConfig">
		<div class="form-row">
			<label for="node-config-input-feedbackTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.topic"></span></label>
			<input type="text" id="node-config-input-feedbackTopic" data-i18n="[placeholder]placeholder.feedbackTopic">
		</div>
		<div class="form-row">
			<label for="node-config-input-feedbackPayloadOn"><i class="fa fa-tag"></i> <span data-i18n="common.onPayload"></span></label>
			<input type="hidden" id="node-config-input-feedbackPayloadOnType">
			<input style="width:70%" type="text" id="node-config-input-feedbackPayloadOn">
		</div>
		<div class="form-row">
			<label for="node-config-input-feedbackPayloadOff"><i class="fa fa-tag"></i> <span data-i18n="common.offPayload"></span></label>
			<input type="hidden" id="node-config-input-feedbackPayloadOffType">
			<input style="width:70%" type="text" id="node-config-input-feedbackPayloadOff">
		</div>
	</div>

	<!-- Absolute timeout -->
	<h3><span data-i18n="head.abstimeout"></span></h3>
	<div class="form-row">
		<label><i class="fa fa-sliders"></i> <span data-i18n="common.time"></span></label>
		<input type="checkbox" id="node-config-input-absTimeoutActive" style="display:inline-block; width:auto;">
		<input type="number" id="node-config-input-absTimeoutValue" min="1" style="text-align: end; width: 70px !important; margin-left: 5px">
		<select id="node-config-input-absTimeoutUnit" style="width:140px !important">
			<option value="s" data-i18n="common.seconds"></option>
			<option value="m" data-i18n="common.minutes"></option>
			<option value="h" data-i18n="common.hours"></option>
		</select>
	</div>

	<!-- Output message -->
	<h3><span data-i18n="head.output"></span></h3>
	<div class="form-row">
		<label for="node-config-input-outputTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.topic"></span></label>
		<input type="text" id="node-config-input-outputTopic" data-i18n="[placeholder]placeholder.outputTopic">
	</div>
	<div class="form-row">
		<label for="node-config-input-outputPayloadOn"><i class="fa fa-tag"></i> <span data-i18n="common.onPayload"></span></label>
		<input type="hidden" id="node-config-input-outputPayloadOnType"><input style="width:70%" type="text" id="node-config-input-outputPayloadOn">
	</div>
	<div class="form-row">
		<label for="node-config-input-outputPayloadOff"><i class="fa fa-tag"></i> <span data-i18n="common.offPayload"></span></label>
		<input type="hidden" id="node-config-input-outputPayloadOffType">
		<input style="width:70%" type="text" id="node-config-input-outputPayloadOff">
	</div>

</script>

<!-- END configuration -->

<!-- BEGIN Node -->

<script type="text/html" data-template-name="powerswitch">
	<style>
		.red-ui-editor .form-row label {
			width: 130px
		}
		.red-ui-editor .form-tips {
			margin-top: 20px;
			margin-bottom: 20px;
		}
	</style>

	<!-- Name -->
	<div class="form-row">
		<label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.name"></span></label>
		<input type="text" id="node-input-name" data-i18n="[placeholder]placeholder.name">
	</div>

	<!-- Configuration Set -->
	<div class="form-row">
		<label for="node-input-configSet"><i class="fa fa-sliders"></i> <span data-i18n="common.configSet"></span></label>
		<input type="text" id="node-input-configSet">
	</div>

	<!-- Present old settings -->
	<div class="form-tips" id="v1settings" style="display:none">

		<p>
			<span data-i18n="specifics.v1updatedMsg1"></span>
			<a href="#" target="_blank"><span data-i18n="specifics.v1updatedLink"></span></a>		<!-- TODO Richtigen Link einfügen -->
		</p>
		<p>
			<h2><span data-i18n="specifics.v1updatedMsg2"></span></h2>
		</p>


		<div id="v1settings-toggle" style="display:none">
			<h3><span data-i18n="head.toggle"></span></h3>
			<div id="v1settings-toggleTopic" style="display:none"><span data-i18n="common.topic"></span>: <code><span id="v1settings-toggleTopicValue"></span></code><br></div>
			<div id="v1settings-togglePayload" style="display:none"><span data-i18n="common.payload"></span>: <code><span id="v1settings-togglePayloadValue"></span></code></div>
		</div>

		<div id="v1settings-motion" style="display:none">
			<h3><span data-i18n="head.motion"></span></h3>
			<div id="v1settings-motionTopic" style="display:none"><span data-i18n="common.topic"></span>: <code><span id="v1settings-motionTopicValue"></span></code><br></div>
			<div id="v1settings-motionOnPayload" style="display:none"><span data-i18n="common.onPayload"></span>: <code><span id="v1settings-motionOnPayloadValue"></span></code><br></div>
			<div id="v1settings-motionOffPayload" style="display:none"><span data-i18n="common.offPayload"></span>: <code><span id="v1settings-motionOffPayloadValue"></span></code><br></div>
			<div id="v1settings-motionTimeout" style="display:none"><span data-i18n="common.timeout"></span>: <code><span id="v1settings-motionTimeoutValue"></span></code><br></div>
			<div id="v1settings-motionAllowTimeoutOverride" style="display:none"><span data-i18n="common.allow"></span> <span data-i18n="common.timeoutoverride"></span>: <code><span id="v1settings-motionAllowTimeoutOverrideValue"></span></code><br></div>
			<div id="v1settings-motionIgnoreForSecsAfterManOff" style="display:none"><span data-i18n="common.ignoreFor"></span> <span data-i18n="common.secsAfterManOff"></span>: <code><span id="v1settings-motionIgnoreForSecsAfterManOffValue"></span> <span data-i18n="common.seconds"></span></code></div>
		</div>

		<div id="v1settings-force" style="display:none">
			<h3><span data-i18n="head.force"></span></h3>
			<div id="v1settings-forceTopic" style="display:none"><span data-i18n="common.topic"></span>: <code><span id="v1settings-forceTopicValue"></span></code><br></div>
			<div id="v1settings-forceOnPayload" style="display:none"><span data-i18n="common.onPayload"></span>: <code><span id="v1settings-forceOnPayloadValue"></span></code><br></div>
			<div id="v1settings-forceMotionOverridesForceOn" style="display:none"><span data-i18n="common.motionOverridesForceOn"></span>: <code><span id="v1settings-forceMotionOverridesForceOnValue"></span></code><br></div>
			<div id="v1settings-forceOffPayload" style="display:none"><span data-i18n="common.offPayload"></span>: <code><span id="v1settings-forceOffPayloadValue"></span></code></div>
		</div>

		<div id="v1settings-feedback" style="display:none">
			<h3><span data-i18n="head.feedback"></span></h3>
			<span data-i18n="common.enable"></span>: <code><span id="v1settings-feedbackActiveValue"></span></code><br>
			<div id="v1settings-feedbackTopic" style="display:none"><span data-i18n="common.topic"></span>: <code><span id="v1settings-feedbackTopicValue"></span></code><br></div>
			<div id="v1settings-feedbackOnPayload" style="display:none"><span data-i18n="common.onPayload"></span>: <code><span id="v1settings-feedbackOnPayloadValue"></span></code><br></div>
			<div id="v1settings-feedbackOffPayload" style="display:none"><span data-i18n="common.offPayload"></span>: <code><span id="v1settings-feedbackOffPayloadValue"></span></code></div>
		</div>

		<div id="v1settings-abstimeout" style="display:none">
			<h3><span data-i18n="head.abstimeout"></span></h3>
			<span data-i18n="common.time"></span>: <code><span id="v1settings-abstimeoutTimeValue"></span></code>
		</div>

		<div id="v1settings-output" style="display:none">
			<h3><span data-i18n="head.output"></span></h3>
			<div id="v1settings-outputTopic" style="display:none"><span data-i18n="common.topic"></span>: <code><span id="v1settings-outputTopicValue"></span></code><br></div>
			<div id="v1settings-outputOnPayload" style="display:none"><span data-i18n="common.onPayload"></span>: <code><span id="v1settings-outputOnPayloadValue"></span></code><br></div>
			<div id="v1settings-outputOffPayload" style="display:none"><span data-i18n="common.offPayload"></span>: <code><span id="v1settings-outputOffPayloadValue"></span></code></div>
		</div>

		<br>

		<button type="button" id="v1settings-dismissButton1" style="width: 200px"><span data-i18n="specifics.v1dismissButton1"></span></button>
		<button type="button" id="v1settings-dismissButton2" style="display:none; width: 200px;"><span data-i18n="specifics.v1dismissButton2"></span></button>
		<!-- TODO Set node to dirty when clicked -->
	</div>

</script>

<script type="text/javascript">
	RED.nodes.registerType('powerswitch',{
		category: 'Smart Home',
		color: '#C0DEED',
		defaults: {
			name: {value: ""},
			configSet: {type: "powerswitch configuration"},

			// BEGIN Toggle
			toggleTopic: {},
			togglePayload: {},
			togglePayloadType: {},
			// BEGIN Motion Detector
			motionTopic: {},
			motionPayloadOn: {},
			motionPayloadOnType: {},
			motionPayloadOff: {},
			motionPayloadOffType: {},
			motionTimeoutValue: {},
			motionTimeoutUnit: {},
			motionTimeoutOverride: {},
			motionOnIgnoreActive: {},
			motionOnIgnoreTime: {},
			// BEGIN Force Command
			forceTopic: {},
			forcePayloadOn: {},
			forcePayloadOnType: {},
			motionOverridesForceOn: {},
			forcePayloadOff: {},
			forcePayloadOffType: {},
			// BEGIN Device Feedback
			feedbackActive: {},
			feedbackTopic: {},
			feedbackPayloadOn: {},
			feedbackPayloadOnType: {},
			feedbackPayloadOff: {},
			feedbackPayloadOffType: {},
			// BEGIN Absolute Timeout
			absTimeoutActive: {},
			absTimeoutValue: {},
			absTimeoutUnit: {},
			// BEGIN Output
			outputTopic: {},
			outputPayloadOnType: {},
			outputPayloadOn: {},
			outputPayloadOffType: {},
			outputPayloadOff: {}

		},
		inputs: 1,
		outputs: 1,
		icon: "font-awesome/fa-lightbulb-o",
		label: function() {
			return this.name || "Powerswitch"
		},
		oneditprepare: function() {
			// Help button
			$('<button type="button" class="ui-button ui-corner-all ui-widget"><i class="fa fa-book"></i> Manual</button>')
			.on("click", () => {RED.sidebar.help.show(this.type)})
			.insertBefore($("#node-dialog-cancel"))

			// Present read-only settings from prrevious version

			// TOGGLE
			if (this.toggleTopic && this.toggleTopic != "toggle") {
				$('#v1settings').show()
				$('#v1settings-toggle').show()
				$('#v1settings-toggleTopic').show()
				$('#v1settings-toggleTopicValue').append(this.toggleTopic)
			}

			if (this.togglePayload && (this.togglePayloadType != "bool" || this.togglePayload != "true")) {
				$('#v1settings').show()
				$('#v1settings-toggle').show()
				$('#v1settings-togglePayload').show()
				$('#v1settings-togglePayloadValue').append(this.togglePayloadType + ' ' + this.togglePayload)
			}

			// MOTION
			if (this.motionTopic && this.motionTopic != "motion") {
				$('#v1settings').show()
				$('#v1settings-motion').show()
				$('#v1settings-motionTopic').show()
				$('#v1settings-motionTopicValue').append(this.motionTopic)
			}
			if (this.motionPayloadOn && (this.motionPayloadOnType != "bool" || this.motionPayloadOn != "true")) {
				$('#v1settings').show()
				$('#v1settings-motion').show()
				$('#v1settings-motionOnPayload').show()
				$('#v1settings-motionOnPayloadValue').append(this.motionPayloadOnType + ' ' + this.motionPayloadOn)
			}
			if (this.motionPayloadOff && (this.motionPayloadOffType != "bool" || this.motionPayloadOff != "false")) {
				$('#v1settings').show()
				$('#v1settings-motion').show()
				$('#v1settings-motionOffPayload').show()
				$('#v1settings-motionOffPayloadValue').append(this.motionPayloadOffType + ' ' + this.motionPayloadOff)
			}
			if ((this.motionTimeoutValue || this.motionTimeoutUnit) && (this.motionTimeoutValue != 2 || this.motionTimeoutUnit != "m")) {
				$('#v1settings').show()
				$('#v1settings-motion').show()
				$('#v1settings-motionTimeout').show()
				$('#v1settings-motionTimeoutValue').append((this.motionTimeoutValue || 2) + ' ' + (this.motionTimeoutUnit || "m"))		// TODO veroderung testen
			}
			if (this.motionTimeoutOverride) {
				$('#v1settings').show()
				$('#v1settings-motion').show()
				$('#v1settings-motionAllowTimeoutOverride').show()
				$('#v1settings-motionAllowTimeoutOverrideValue').append(this.motionTimeoutOverride)
			}
			if (this.motionOnIgnoreActive) {
				$('#v1settings').show()
				$('#v1settings-motion').show()
				$('#v1settings-motionIgnoreForSecsAfterManOff').show()
				$('#v1settings-motionIgnoreForSecsAfterManOffValue').append(this.motionOnIgnoreTime)
			}

			// FORCE
			if (this.forceTopic && this.forceTopic != "force") {
				$('#v1settings').show()
				$('#v1settings-force').show()
				$('#v1settings-forceTopic').show()
				$('#v1settings-forceTopicValue').append(this.forceTopic)
			}
			if (this.forcePayloadOn && (this.forcePayloadOnType != "bool" || this.forcePayloadOn != "true")) {
				$('#v1settings').show()
				$('#v1settings-force').show()
				$('#v1settings-forceOnPayload').show()
				$('#v1settings-forceOnPayloadValue').append(this.forcePayloadOnType + ' ' + this.forcePayloadOn)
			}
			if (this.motionOverridesForceOn) {
				$('#v1settings').show()
				$('#v1settings-force').show()
				$('#v1settings-forceMotionOverridesForceOn').show()
				$('#v1settings-forceMotionOverridesForceOnValue').append(this.motionOverridesForceOn)
			}
			if (this.forcePayloadOff && (this.forcePayloadOffType != "bool" || this.forcePayloadOff != "false")) {
				$('#v1settings').show()
				$('#v1settings-force').show()
				$('#v1settings-forceOffPayload').show()
				$('#v1settings-forceOffPayloadValue').append(this.forcePayloadOffType + ' ' + this.forcePayloadOff)
			}
			
			// FEEDBACK
			if (this.feedbackActive) {
				$('#v1settings').show()
				$('#v1settings-feedback').show()
				$('#v1settings-feedbackActiveValue').append(this.feedbackActive)

				if (this.feedbackTopic && this.feedbackTopic != "feedback") {
					$('#v1settings-feedbackTopic').show()
					$('#v1settings-feedbackTopicValue').append(this.feedbackTopic)
				}
				if (this.feedbackPayloadOn && (this.feedbackPayloadOnType != "bool" || this.feedbackPayloadOn != "true")) {
					$('#v1settings-feedbackOnPayload').show()
					$('#v1settings-feedbackOnPayloadValue').append(this.feedbackPayloadOnType + ' ' + this.feedbackPayloadOn)
				}
				if (this.feedbackPayloadOff && (this.feedbackPayloadOffType != "bool" || this.feedbackPayloadOff != "false")) {
					$('#v1settings-feedbackOffPayload').show()
					$('#v1settings-feedbackOffPayloadValue').append(this.feedbackPayloadOffType + ' ' + this.feedbackPayloadOff)
				}
			}
				
			// ABSOLUTE TIMEOUT
			if (this.absTimeoutActive) {
				$('#v1settings').show()
				$('#v1settings-abstimeout').show()
				$('#v1settings-abstimeoutTimeValue').append((this.absTimeoutValue || 1) + ' ' + (this.absTimeoutUnit || "h"))		// TODO veroderung testen
			}
			
			// OUTPUT
			if (this.outputTopic && this.outputTopic != "command") {
				$('#v1settings').show()
				$('#v1settings-output').show()
				$('#v1settings-outputTopic').show()
				$('#v1settings-outputTopicValue').append(this.outputTopic)
			}
			if (this.outputPayloadOn && (this.outputPayloadOnType != "bool" || this.outputPayloadOn != "true")) {
				$('#v1settings').show()
				$('#v1settings-output').show()
				$('#v1settings-outputOnPayload').show()
				$('#v1settings-outputOnPayloadValue').append(this.outputPayloadOnType + ' ' + this.outputPayloadOn)
			}
			if (this.outputPayloadOff && (this.outputPayloadOffType != "bool" || this.outputPayloadOff != "false")) {
				$('#v1settings').show()
				$('#v1settings-output').show()
				$('#v1settings-outputOffPayload').show()
				$('#v1settings-outputOffPayloadValue').append(this.outputPayloadOffType + ' ' + this.outputPayloadOff)
			}

			$('#v1settings-dismissButton1').on("click",() => {
				$('#v1settings-dismissButton1').hide()
				$('#v1settings-dismissButton2').show()
			})

			$('#v1settings-dismissButton2').on("click",() => {
				this.toggleTopic = undefined
				this.togglePayload = undefined
				this.togglePayloadType = undefined
				this.motionTopic = undefined
				this.motionPayloadOn = undefined
				this.motionPayloadOnType = undefined
				this.motionPayloadOff = undefined
				this.motionPayloadOffType = undefined
				this.motionTimeoutValue = undefined
				this.motionTimeoutUnit = undefined
				this.motionTimeoutOverride = undefined
				this.motionOnIgnoreActive = undefined
				this.motionOnIgnoreTime = undefined
				this.forceTopic = undefined
				this.forcePayloadOn = undefined
				this.forcePayloadOnType = undefined
				this.motionOverridesForceOn = undefined
				this.forcePayloadOff = undefined
				this.forcePayloadOffType = undefined
				this.feedbackActive = undefined
				this.feedbackTopic = undefined
				this.feedbackPayloadOn = undefined
				this.feedbackPayloadOnType = undefined
				this.feedbackPayloadOff = undefined
				this.feedbackPayloadOffType = undefined
				this.absTimeoutActive = undefined
				this.absTimeoutValue = undefined
				this.absTimeoutUnit = undefined
				this.outputTopic = undefined
				this.outputPayloadOnType = undefined
				this.outputPayloadOn = undefined
				this.outputPayloadOffType = undefined
				this.outputPayloadOff = undefined
				$('#v1settings').hide(300)
			})

		}
	});
</script>

<!-- END Node -->